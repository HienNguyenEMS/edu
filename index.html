<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebApp Quản lý Xưởng Giặt - Bình Mai</title>

    <!-- Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        :root {
            --sidebar-width: 260px;
            --sidebar-collapsed-width: 90px;
            --header-height: 70px;
            /* --- UPDATE: New Color Palette --- */
            --primary-color: #0d6efd;
            --sidebar-bg: #1c2b4b; /* Xanh đen */
            --sidebar-header-bg: #131f3b; /* Xanh đen đậm hơn */
            --sidebar-link-color: #a7b1c2;
            --sidebar-link-hover-bg: #293f70;
            --sidebar-link-active-color: #ffffff;
            --body-bg: #f8f9fc;
            --bs-body-font-family: 'Be Vietnam Pro', sans-serif;
        }

        /* --- Base Layout --- */
        .wrapper { display: flex; width: 100%; align-items: stretch; }
        #content { width: 100%; min-height: 100vh; transition: margin-left 0.3s ease-in-out; background-color: var(--body-bg); }

        /* --- Sidebar General Styles (UPDATED) --- */
        #sidebar {
            display: flex;
            flex-direction: column;
            background: var(--sidebar-bg);
            color: var(--sidebar-link-active-color);
            transition: all 0.3s ease-in-out;
            z-index: 1040;
        }
        #sidebar .sidebar-header {
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between; /* UPDATE: Position items correctly */
            padding: 0 15px;
            background: var(--sidebar-header-bg);
            flex-shrink: 0;
        }
        #sidebar .logo-container { text-decoration: none; color: white; display: flex; align-items: center; overflow: hidden; }
        #sidebar .logo { height: 40px; flex-shrink: 0; }
        #sidebar .logo-text { margin-left: 10px; font-weight: 700; font-size: 1.5rem; white-space: nowrap; transition: opacity 0.2s, width 0.2s, margin-left 0.2s; }
        #sidebar .components { padding: 15px 0; flex-grow: 1; overflow-y: auto; }
        #sidebar .components a {
            padding: 12px 20px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            color: var(--sidebar-link-color);
            border-left: 4px solid transparent;
            text-decoration: none;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        #sidebar .components a:hover { color: var(--sidebar-link-active-color); background: var(--sidebar-link-hover-bg); }
        #sidebar .components li.active > a {
            color: var(--sidebar-link-active-color);
            font-weight: 600;
            background: var(--primary-color);
            border-left-color: #f8f9fa;
        }
        #sidebar .fa-fw { font-size: 1.1rem; width: 30px; text-align: center; }
        #sidebar a[data-bs-toggle="collapse"] .collapse-icon { margin-left: auto; transition: transform 0.3s ease; font-size: 0.8rem; }
        #sidebar a[data-bs-toggle="collapse"][aria-expanded="true"] .collapse-icon { transform: rotate(-180deg); }
        #sidebar .collapse a { padding-left: calc(20px + 30px); font-size: 0.9rem; background: rgba(0,0,0,0.2); }
        body.sidebar-collapsed #sidebar .sidebar-header { justify-content: center; } /* Center toggle button when collapsed */
        body.sidebar-collapsed #sidebar .logo-container { display: none; } /* Hide logo when collapsed */


        /* --- Header & Main Content --- */
        .main-header { height: var(--header-height); display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; background-color: #fff; border-bottom: 1px solid #e3e6f0; position: sticky; top: 0; z-index: 1020; }
        .main-content.active { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1); border: 1px solid #e3e6f0; }
        .card-header { font-weight: 600; color: #343a40; background-color: #f7f9fc; border-bottom: 1px solid #e3e6f0; }
        .table-responsive { overflow-x: auto; }
        .table > thead { background-color: #f3f6fc; vertical-align: middle; }
        .table > thead th { font-weight: 600; border-bottom-width: 1px !important; border-color: #e3e6f0 !important; }
        .card-footer { background-color: #fdfdff; border-top: 1px solid #e3e6f0; }

        /* --- MOBILE-FIRST: Off-Canvas Sidebar & Responsive Tabs --- */
        #sidebar { position: fixed; top: 0; left: 0; height: 100vh; width: var(--sidebar-width); transform: translateX(-100%); }
        #sidebar.show { transform: translateX(0); }
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1039; display: none; }
        #sidebar-overlay.active { display: block; }
        #content { margin-left: 0; }
        .nav-tabs-responsive { display: flex; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .nav-tabs-responsive .nav-link { white-space: nowrap; }

        /* --- DESKTOP-UP: Pinned & Collapsible Sidebar --- */
        @media (min-width: 992px) {
            #sidebar { position: fixed; transform: translateX(0); }
            #sidebar-overlay { display: none !important; }
            #content { margin-left: var(--sidebar-width); }
            body.sidebar-collapsed #content { margin-left: var(--sidebar-collapsed-width); }
            body.sidebar-collapsed #sidebar { width: var(--sidebar-collapsed-width); }
            body.sidebar-collapsed #sidebar .logo-text,
            body.sidebar-collapsed #sidebar .nav-link span,
            body.sidebar-collapsed #sidebar .collapse-icon { opacity: 0; width: 0; height: 0; overflow: hidden; margin-left: 0;}
            body.sidebar-collapsed #sidebar .nav-link { justify-content: center; }
            body.sidebar-collapsed #sidebar .fa-fw { margin-right: 0 !important; font-size: 1.5rem; }
            body.sidebar-collapsed #sidebar .collapse.show { display: none; }
        }

        /* Kanban styles */
        .kanban-container { display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 1rem; scroll-snap-type: x mandatory; }
        .kanban-column { flex: 0 0 320px; scroll-snap-align: start; background-color: #f1f2f6; border-radius: 0.5rem; padding: 0.75rem; }
        .kanban-card .card-footer { background-color: transparent; border-top: 1px solid #e3e6f0; }
        .thumb-image { width: 50px; height: 50px; object-fit: cover; }
        
        /* --- NEW: Homepage Menu Styles --- */
        .homepage-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1.5rem;
            border: 1px solid #e3e6f0;
            border-radius: 0.5rem;
            background-color: #fff;
            color: #495057;
            text-decoration: none;
            transition: all 0.2s ease-in-out;
            height: 100%;
        }
        .homepage-menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            color: var(--primary-color);
            background-color: #f8f9fa;
        }
        .homepage-menu-item i {
            color: var(--primary-color);
        }
    </style>
</head>
<body class="sidebar-collapsed"> <!-- Start with collapsed sidebar on desktop -->

<div id="sidebar-overlay"></div>
<div class="wrapper">
    <!-- UPDATE: Sidebar Header HTML structure changed for better layout -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <a href="#" class="logo-container nav-link" data-view="dashboard">
                <img src="https://gpems.net/_next/image?url=%2Flogo-ico.png&w=64&q=75" alt="Logo" class="logo">
                <span class="logo-text">Wash ERP</span>
            </a>
            <button class="btn text-white d-none d-lg-block" type="button" id="desktop-sidebar-toggle-btn"><i class="fas fa-bars"></i></button>
        </div>

        <ul class="list-unstyled components">
            <li class="active"><a href="#" class="nav-link" data-view="dashboard"><i class="fas fa-home fa-fw"></i><span>Trang chủ</span></a></li>
            <li><a href="#" class="nav-link" data-view="orders"><i class="fas fa-file-invoice-dollar fa-fw"></i><span>Đơn hàng</span></a></li>
            <li><a href="#" class="nav-link" data-view="products"><i class="fas fa-tshirt fa-fw"></i><span>Sản phẩm</span></a></li>
            <li><a href="#" class="nav-link" data-view="production"><i class="fas fa-industry fa-fw"></i><span>Sản xuất</span></a></li>
            <li><a href="#" class="nav-link" data-view="delivery"><i class="fas fa-truck fa-fw"></i><span>Giao hàng</span></a></li>
            <li>
                <a href="#financeSubmenu" data-bs-toggle="collapse" class="nav-link">
                    <i class="fas fa-wallet fa-fw"></i><span>Tài chính</span>
                    <i class="fas fa-chevron-down collapse-icon"></i>
                </a>
                <ul class="collapse list-unstyled" id="financeSubmenu">
                    <li><a href="#" class="nav-link" data-view="finance"><span>Thu - Chi</span></a></li>
                    <li><a href="#" class="nav-link" data-view="accounts"><span>Tài khoản</span></a></li>
                </ul>
            </li>
             <li>
                <a href="#hrSubmenu" data-bs-toggle="collapse" class="nav-link">
                    <i class="fas fa-users fa-fw"></i><span>Nhân sự</span>
                    <i class="fas fa-chevron-down collapse-icon"></i>
                </a>
                <ul class="collapse list-unstyled" id="hrSubmenu">
                    <li><a href="#" class="nav-link" data-view="payroll"><span>Bảng lương</span></a></li>
                    <li><a href="#" class="nav-link" data-view="attendance"><span>Chấm công</span></a></li>
                    <li><a href="#" class="nav-link" data-view="leave"><span>Nghỉ phép</span></a></li>
                    <li><a href="#" class="nav-link" data-view="kpis"><span>KPIs</span></a></li>
                </ul>
            </li>
            <hr class="mx-3 bg-secondary">
             <li><a href="#" class="nav-link" data-view="workflows"><i class="fas fa-project-diagram fa-fw"></i><span>Quy trình</span></a></li>
             <li><a href="#" class="nav-link" data-view="user-guide"><i class="fas fa-book-open fa-fw"></i><span>Hướng dẫn</span></a></li>
            <li>
                <a href="#settingsSubmenu" data-bs-toggle="collapse" class="nav-link">
                    <i class="fas fa-cogs fa-fw"></i><span>Cài đặt</span>
                    <i class="fas fa-chevron-down collapse-icon"></i>
                </a>
                <ul class="collapse list-unstyled" id="settingsSubmenu">
                    <li><a href="#" class="nav-link" data-view="master-data"><span>Dữ liệu nguồn</span></a></li>
                    <li><a href="#" class="nav-link" data-view="users"><span>Người dùng</span></a></li>
                    <li><a href="#" class="nav-link" data-view="roles"><span>Phân quyền</span></a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <div id="content">
        <header class="main-header">
            <div class="d-flex align-items-center gap-2 w-100">
                <button class="btn border-0 d-lg-none" type="button" id="mobile-sidebar-toggle-btn"><i class="fas fa-bars fs-4"></i></button>
                <div class="input-group">
                    <span class="input-group-text bg-light border-0"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control bg-light border-0" id="global-search-input" placeholder="Tìm kiếm...">
                </div>
                <div class="d-none d-lg-flex align-items-center gap-2" id="header-filter-container">
                    <div class="btn-group" id="time-filter-dropdown">
                        <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-calendar-alt me-2"></i>
                            <span>Thời gian</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Hôm nay</a></li>
                            <li><a class="dropdown-item" href="#">Tuần này</a></li>
                            <li><a class="dropdown-item" href="#">Tháng này</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="custom-date-range-trigger">Tùy chọn...</a></li>
                        </ul>
                    </div>
                    <div class="d-none" id="custom-date-range-filter">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">Từ</span>
                            <input type="date" class="form-control" style="width: 130px;">
                            <span class="input-group-text">Đến</span>
                            <input type="date" class="form-control" style="width: 130px;">
                            <button class="btn btn-primary" type="button" title="Lọc"><i class="fas fa-search"></i></button>
                            <button class="btn btn-secondary" type="button" id="cancel-custom-date-range" title="Hủy"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex align-items-center flex-shrink-0 ms-3">
                 <div class="dropdown">
                    <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                        <i class="fas fa-bell fa-fw fs-4 text-secondary"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">4<span class="visually-hidden">unread</span></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0" style="width: 350px;">
                        <li class="dropdown-header">Thông báo</li>
                        <li><a class="dropdown-item d-flex align-items-center py-2" href="#"><div class="me-3"><div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-file-alt"></i></div></div><div><div class="small text-muted">10/07/2024 - 10:30</div><span class="fw-bold">Đơn hàng DH-07019 sắp trễ hẹn!</span></div></a></li>
                        <li><a class="dropdown-item d-flex align-items-center py-2" href="#"><div class="me-3"><div class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-exclamation-triangle"></i></div></div><div><div class="small text-muted">10/07/2024 - 09:15</div><span>Lô SX LÔ-0708-AP01 báo cáo sự cố.</span></div></a></li>
                        <li><a class="dropdown-item d-flex align-items-center py-2" href="#"><div class="me-3"><div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-check-circle"></i></div></div><div><div class="small text-muted">09/07/2024 - 17:00</div><span>Đơn nghỉ phép của Trần Thị B đã được duyệt.</span></div></a></li>
                        <li><a class="dropdown-item d-flex align-items-center py-2" href="#"><div class="me-3"><div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-truck"></i></div></div><div><div class="small text-muted">09/07/2024 - 16:30</div><span>Phiếu giao GH-0709A đã hoàn thành.</span></div></a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-center small text-muted" href="#">Xem tất cả</a></li>
                    </ul>
                </div>
                <div class="dropdown ms-3">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                        <img src="https://i.pravatar.cc/40?u=binhmai" alt="Avatar" width="40" height="40" class="rounded-circle me-2">
                        <div class="d-none d-sm-block">
                            <strong class="d-block">Binh Mai</strong>
                            <small class="text-muted">Admin</small>
                        </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                        <li><a class="dropdown-item nav-link-profile" data-view="my-profile" href="#"><i class="fas fa-user-circle fa-fw me-2"></i>Thông tin cá nhân</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt fa-fw me-2"></i>Đăng xuất</a></li>
                    </ul>
                </div>
            </div>
        </header>
        <main id="main-content-area" class="p-3 p-lg-4"></main>
    </div>
</div>

<!-- ALL MODALS (Unchanged) -->
<div class="modal fade" id="order-modal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true"><div class="modal-dialog modal-xl modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="orderModalLabel">Chi tiết Đơn hàng</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="order-form"><h6 class="text-primary">Thông tin chung</h6><hr class="mt-1"><div class="row g-3"><div class="col-md-4"><label class="form-label">Khách hàng</label><select class="form-select"><option selected>Chọn khách hàng...</option><option>An Phước</option><option>Blue Exchange</option></select></div><div class="col-md-4"><label class="form-label">Ngày nhận</label><input type="date" class="form-control" value="2025-07-04"></div><div class="col-md-4"><label class="form-label">Hạn giao hàng</label><input type="date" class="form-control" value="2025-07-15"></div></div><h6 class="text-primary mt-4">Chi tiết Sản phẩm</h6><hr class="mt-1"><div class="table-responsive"><table class="table table-sm table-bordered"><thead><tr><th>Sản phẩm</th><th style="width:120px">Số lượng</th><th style="width:150px">Đơn giá</th><th style="width:180px">Thành tiền</th><th style="width:50px"></th></tr></thead><tbody><tr><td><select class="form-select form-select-sm"><option>QJ-AP-01 - Quần Jean Nam</option><option>SM-AP-02 - Áo Sơ Mi</option></select></td><td><input type="number" class="form-control form-control-sm" value="500"></td><td><input type="number" class="form-control form-control-sm" value="35000"></td><td><input type="text" class="form-control form-control-sm" value="17,500,000" readonly></td><td class="text-center"><button type="button" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button></td></tr><tr><td><select class="form-select form-select-sm"><option>QJ-AP-01 - Quần Jean Nam</option><option selected>SM-AP-02 - Áo Sơ Mi</option></select></td><td><input type="number" class="form-control form-control-sm" value="200"></td><td><input type="number" class="form-control form-control-sm" value="25000"></td><td><input type="text" class="form-control form-control-sm" value="5,000,000" readonly></td><td class="text-center"><button type="button" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button></td></tr></tbody></table></div><button type="button" class="btn btn-sm btn-outline-primary"><i class="fas fa-plus me-1"></i>Thêm SP</button></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary"><i class="fas fa-save me-2"></i>Lưu</button></div></div></div></div>
<div class="modal fade" id="product-modal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="productModalLabel">Chi tiết Sản phẩm</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Mã sản phẩm</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Tên sản phẩm</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Khách hàng</label><select class="form-select"><option>An Phước</option><option>Blue Exchange</option><option>Canifa</option><option>Owen</option></select></div><div class="col-md-6"><label class="form-label">Đơn giá</label><input type="number" class="form-control"></div><div class="col-12"><label class="form-label">Mô tả</label><textarea class="form-control" rows="3"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="scan-modal" tabindex="-1" aria-labelledby="scanModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="scanModalLabel"><i class="fas fa-barcode me-2"></i>Ghi Nhật Ký Sản Xuất</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="row g-4"><div class="col-md-5"><h6>Camera Scan</h6><div id="scan-camera-feed" class="d-flex align-items-center justify-content-center text-muted bg-dark border border-secondary rounded" style="min-height: 200px;"><i>Camera feed</i></div><div class="d-grid mt-2"><button class="btn btn-outline-primary"><i class="fas fa-camera me-2"></i>Bắt đầu quét</button></div></div><div class="col-md-7"><h6>Thông tin Cập nhật</h6><div class="mb-3"><label class="form-label">Mã Lô/Đơn hàng</label><input type="text" class="form-control" value="LÔ-0708-AP01" readonly></div><div class="mb-3"><label class="form-label">Công đoạn</label><select class="form-select"><option>Giặt/Nhuộm</option><option>Wash/Ủi</option></select></div><div class="row g-3"><div class="col-sm-6"><label class="form-label">Số lượng thực tế</label><input type="number" class="form-control"></div><div class="col-sm-6"><label class="form-label">Số lượng hư</label><input type="number" class="form-control text-danger"></div></div><div class="mt-3"><label class="form-label">Người thực hiện</label><input type="text" class="form-control" value="Binh Mai" readonly></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button><button type="button" class="btn btn-success"><i class="fas fa-check me-2"></i>Lưu Nhật Ký</button></div></div></div></div>
<div class="modal fade" id="delivery-modal" tabindex="-1" aria-labelledby="deliveryModalLabel" aria-hidden="true"><div class="modal-dialog modal-xl modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="deliveryModalLabel">Chi tiết Phiếu giao hàng</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><h6 class="text-primary">Thông tin chung</h6><hr class="mt-1"><div class="row g-3"><div class="col-md-4"><label class="form-label">Khách hàng</label><input type="text" class="form-control" value="An Phước" readonly></div><div class="col-md-4"><label class="form-label">Người giao</label><input type="text" class="form-control"></div><div class="col-md-4"><label class="form-label">Ngày giao</label><input type="date" class="form-control"></div><div class="col-12"><label class="form-label">Địa chỉ giao</label><input type="text" class="form-control" value="KCN Tân Bình, TP.HCM" readonly></div></div><h6 class="text-primary mt-4">Chi tiết hàng hóa giao</h6><hr class="mt-1"><div class="table-responsive"><table class="table table-sm table-bordered"><thead><tr><th>Mã Lô SX</th><th>Sản phẩm</th><th style="width:120px">Số lượng</th></tr></thead><tbody><tr><td><select class="form-select form-select-sm"><option selected>LÔ-0708-AP01</option><option>LÔ-0708-AP02</option></select></td><td>Quần Jean QJ-AP-01</td><td><input type="number" class="form-control form-control-sm" value="500"></td></tr><tr><td><select class="form-select form-select-sm"><option>LÔ-0708-AP01</option><option selected>LÔ-0708-AP02</option></select></td><td>Áo Sơ Mi SM-AP-02</td><td><input type="number" class="form-control form-control-sm" value="200"></td></tr></tbody></table></div><button type="button" class="btn btn-sm btn-outline-primary"><i class="fas fa-plus me-1"></i>Thêm dòng</button></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button><button type="button" class="btn btn-primary"><i class="fas fa-shipping-fast me-2"></i>Xác nhận</button></div></div></div></div>
<div class="modal fade" id="customer-modal" tabindex="-1" aria-labelledby="customerModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="customerModalLabel">Chi tiết Khách hàng</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Mã khách hàng</label><input type="text" class="form-control" placeholder="Hệ thống tự tạo..."></div><div class="col-md-6"><label class="form-label">Tên công ty</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Mã số thuế</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Người liên hệ</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Số điện thoại</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Email</label><input type="email" class="form-control"></div><div class="col-12"><label class="form-label">Địa chỉ</label><input type="text" class="form-control"></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="user-modal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="userModalLabel">Chi tiết Người dùng</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Tên hiển thị</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Tên đăng nhập</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Email</label><input type="email" class="form-control"></div><div class="col-md-6"><label class="form-label">Số điện thoại</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Phòng ban</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Chức vụ</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Vai trò</label><select class="form-select"><option>Admin</option><option>Quản lý</option><option>Nhân viên</option></select></div><div class="col-md-6"><label class="form-label">Trạng thái</label><select class="form-select"><option value="1">Hoạt động</option><option value="0">Khóa</option></select></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="finance-modal" tabindex="-1" aria-labelledby="financeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="financeModalLabel">Chi tiết Phiếu</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Ngày</label><input type="date" class="form-control"></div><div class="col-md-6"><label class="form-label">Số tiền</label><input type="number" class="form-control"></div><div class="col-md-6"><label class="form-label">Hạng mục</label><select class="form-select"><option>Thanh toán ĐH</option><option>Chi phí vật tư</option></select></div><div class="col-md-6"><label class="form-label" id="finance-entity-label">Khách hàng</label><select class="form-select"><option>Blue Exchange</option><option>Nhà cung cấp Hóa Chất ABC</option></select></div><div class="col-12"><label class="form-label">Ghi chú</label><textarea class="form-control" rows="3"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary"><i class="fas fa-save me-2"></i>Lưu</button></div></div></div></div>
<div class="modal fade" id="role-modal" tabindex="-1" aria-labelledby="roleModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="roleModalLabel">Chi tiết Vai trò</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="mb-3"><label for="roleName" class="form-label">Tên Vai Trò</label><input type="text" id="roleName" class="form-control"></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="stage-modal" tabindex="-1" aria-labelledby="stageModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="stageModalLabel">Chi tiết Công đoạn</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="mb-3"><label class="form-label">Tên công đoạn</label><input type="text" class="form-control"></div><div class="mb-3"><label class="form-label">Đơn giá</label><input type="number" class="form-control"></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="account-modal" tabindex="-1" aria-labelledby="accountModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="accountModalLabel">Chi tiết Tài khoản</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Tên tài khoản</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Loại tài khoản</label><select class="form-select"><option>Tiền mặt</option><option>Chuyển khoản</option></select></div><div class="col-md-6"><label class="form-label">Số dư ban đầu</label><input type="number" class="form-control"></div><div class="col-md-6"><label class="form-label">Trạng thái</label><select class="form-select"><option value="1">Hoạt động</option><option value="0">Tạm khóa</option></select></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="audit-modal" tabindex="-1" aria-labelledby="auditModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="auditModalLabel">Thực hiện Kiểm Kê Quỹ</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Tài khoản</label><select class="form-select"><option>Quỹ tiền mặt</option><option>TK Vietcombank</option></select></div><div class="col-md-6"><label class="form-label">Ngày kiểm kê</label><input type="date" class="form-control"></div><div class="col-md-6"><label class="form-label">Số dư hệ thống</label><input type="text" class="form-control" value="50,250,000" readonly></div><div class="col-md-6"><label class="form-label">Số dư thực tế</label><input type="number" class="form-control"></div><div class="col-12"><label class="form-label">Ghi chú</label><textarea class="form-control" rows="2"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button><button type="button" class="btn btn-primary">Xác nhận</button></div></div></div></div>
<div class="modal fade" id="attendance-modal" tabindex="-1" aria-labelledby="attendanceModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="attendanceModalLabel">Chấm Công</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>Nhân viên: <strong>Binh Mai</strong></p><p>Thời gian hiện tại: <strong id="current-time"></strong></p><p>Bạn muốn thực hiện Check-in hay Check-out?</p></div><div class="modal-footer"><button type="button" class="btn btn-success"><i class="fas fa-sign-in-alt me-2"></i>Check-in</button><button type="button" class="btn btn-danger"><i class="fas fa-sign-out-alt me-2"></i>Check-out</button></div></div></div></div>
<div class="modal fade" id="leave-modal" tabindex="-1" aria-labelledby="leaveModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="leaveModalLabel">Chi tiết Đơn nghỉ phép</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Loại phép</label><select class="form-select"><option>Nghỉ phép năm</option><option>Nghỉ ốm</option><option>Nghỉ không lương</option></select></div><div class="col-md-6"><label class="form-label">Số ngày nghỉ</label><input type="number" class="form-control" value="1"></div><div class="col-md-6"><label class="form-label">Từ ngày</label><input type="date" class="form-control"></div><div class="col-md-6"><label class="form-label">Đến ngày</label><input type="date" class="form-control"></div><div class="col-12"><label class="form-label">Lý do</label><textarea class="form-control" rows="3"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button><button type="button" class="btn btn-primary"><i class="fas fa-paper-plane me-2"></i>Gửi</button></div></div></div></div>
<div class="modal fade" id="workflow-modal" tabindex="-1" aria-labelledby="workflowModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="workflowModalLabel">Chi tiết Quy trình</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="mb-3"><label class="form-label">Tên quy trình</label><input type="text" class="form-control"></div><div class="mb-3"><label class="form-label">Các bước (Enumlist, cách nhau bởi dấu ->)</label><input type="text" class="form-control" placeholder="Trạng thái 1 -> Trạng thái 2 -> ..."></div><div class="mb-3"><label class="form-label">Mô tả</label><textarea class="form-control" rows="3"></textarea></div><div class="row g-3"><div class="col-md-6"><label class="form-label">Người phụ trách</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Lead Time (ngày)</label><input type="number" class="form-control"></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="guide-modal" tabindex="-1" aria-labelledby="guideModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="guideModalLabel">Chi tiết Hướng dẫn</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="mb-3"><label class="form-label">Tiêu đề (Tên Module)</label><input type="text" class="form-control"></div><div class="mb-3"><label class="form-label">Nội dung</label><textarea class="form-control" rows="6"></textarea></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="incident-modal" tabindex="-1" aria-labelledby="incidentModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="incidentModalLabel">Chi tiết Sự cố</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-6"><label class="form-label">Ngày</label><input type="date" class="form-control"></div><div class="col-md-6"><label class="form-label">Bộ phận</label><select class="form-select"><option>Giặt</option><option>Ủi</option><option>Nhuộm</option></select></div><div class="col-md-6"><label class="form-label">Sản phẩm / Máy</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Số lượng ảnh hưởng</label><input type="number" class="form-control"></div><div class="col-12"><label class="form-label">Lỗi phát sinh</label><textarea class="form-control" rows="2"></textarea></div><div class="col-12"><label class="form-label">Hướng xử lý</label><textarea class="form-control" rows="2"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>
<div class="modal fade" id="equipment-modal" tabindex="-1" aria-labelledby="equipmentModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="equipmentModalLabel">Chi tiết Thiết bị</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="row g-3"><div class="col-md-4"><label class="form-label">Ảnh đại diện</label><input type="file" class="form-control"></div><div class="col-md-8"><label class="form-label">Tên thiết bị</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Model</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Xuất xứ</label><input type="text" class="form-control"></div><div class="col-md-6"><label class="form-label">Ngày sử dụng</label><input type="date" class="form-control"></div><div class="col-md-6"><label class="form-label">Công suất định mức</label><input type="text" class="form-control"></div><div class="col-12"><label class="form-label">Thông số kỹ thuật</label><textarea class="form-control" rows="3"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" class="btn btn-primary">Lưu</button></div></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const mainContentArea = document.getElementById('main-content-area');
    const globalSearchInput = document.getElementById('global-search-input');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const desktopSidebarToggleBtn = document.getElementById('desktop-sidebar-toggle-btn');
    const mobileSidebarToggleBtn = document.getElementById('mobile-sidebar-toggle-btn');
    const timeFilterDropdown = document.getElementById('time-filter-dropdown');
    const customDateRangeFilter = document.getElementById('custom-date-range-filter');
    const customDateRangeTrigger = document.getElementById('custom-date-range-trigger');
    const cancelCustomDateRangeBtn = document.getElementById('cancel-custom-date-range');
    
    // Placeholder for chart instances
    let chartInstances = {};
    let bsTooltipList = [];

    const searchPlaceholders = {
        dashboard: 'Tìm kiếm chức năng...',
        orders: 'Tìm kiếm theo mã ĐH, tên khách...',
        products: 'Tìm kiếm theo mã, tên sản phẩm...',
        production: 'Tìm kiếm lô sản xuất, sự cố...',
        payroll: 'Tìm kiếm theo nhân viên, công đoạn...',
        finance: 'Tìm kiếm phiếu thu, chi...',
        accounts: 'Tìm kiếm tài khoản, kiểm kê...',
        delivery: 'Tìm kiếm phiếu giao, khách hàng...',
        'master-data': 'Tìm kiếm dữ liệu nguồn...',
        users: 'Tìm kiếm người dùng...',
        roles: 'Tìm kiếm vai trò...',
        'my-profile': 'Tìm kiếm thông tin cá nhân...',
        attendance: 'Tìm kiếm chấm công theo nhân viên...',
        leave: 'Tìm kiếm đơn nghỉ phép...',
        kpis: 'Tìm kiếm KPIs theo nhân viên, tháng...',
        workflows: 'Tìm kiếm quy trình...',
        'user-guide': 'Tìm kiếm hướng dẫn...',
    };
    
    // --- UPDATE: View Templates with Homepage Menu, Pagination and other fixes ---
    const viewTemplates = {
        // --- REQUIREMENT 1: New Homepage Menu ---
        dashboard: `
            <h3 class="mb-4">Menu Chức Năng</h3>
            <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-3">
                <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="orders">
                        <i class="fas fa-file-invoice-dollar fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Đơn Hàng</h6>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="production">
                        <i class="fas fa-industry fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Sản Xuất</h6>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="delivery">
                        <i class="fas fa-truck fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Giao Hàng</h6>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="finance">
                        <i class="fas fa-wallet fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Tài Chính</h6>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="hrSubmenu">
                        <i class="fas fa-users fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Nhân Sự</h6>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="products">
                        <i class="fas fa-tshirt fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Sản Phẩm</h6>
                    </a>
                </div>
                 <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="reports">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Báo Cáo</h6>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="homepage-menu-item nav-link" data-view="settingsSubmenu">
                        <i class="fas fa-cogs fa-3x mb-3"></i>
                        <h6 class="fw-bold mb-0">Cài Đặt</h6>
                    </a>
                </div>
            </div>`,
        
        // --- REQUIREMENT 3: Added Pagination to all relevant views ---
        orders: `<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2"><h3>Đơn hàng</h3><div class="btn-group"><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#order-modal"><i class="fas fa-plus me-2"></i>Thêm Đơn</button><button class="btn btn-outline-success"><i class="fas fa-file-excel me-2"></i>Xuất Excel</button></div></div>
            <div class="card shadow-sm">
                <div class="card-header">Danh sách Đơn hàng</div>
                <div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Mã ĐH</th><th>Khách hàng</th><th>Hoàn thành</th><th>Trạng thái</th><th class="text-end">Tổng tiền</th><th class="text-center">Hành động</th></tr></thead><tbody><tr><td>DH-0708A</td><td>An Phước</td><td><div class="progress" role="progressbar" style="height: 20px;"><div class="progress-bar bg-primary" style="width: 10%">10%</div></div></td><td><span class="badge bg-primary">Mới nhận</span></td><td class="text-end">22.5M</td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#order-modal"><i class="fas fa-edit"></i></button><div class="btn-group btn-group-sm" role="group"><button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-sync-alt"></i></button><ul class="dropdown-menu"><li><a class="dropdown-item" href="#">Sản xuất</a></li></ul></div></div></td></tr><tr><td>DH-0707B</td><td>Blue Exchange</td><td><div class="progress" role="progressbar" style="height: 20px;"><div class="progress-bar bg-warning" style="width: 50%">50%</div></div></td><td><span class="badge bg-warning text-dark">Đang sản xuất</span></td><td class="text-end">55.0M</td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#order-modal"><i class="fas fa-edit"></i></button><div class="btn-group btn-group-sm" role="group"><button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-sync-alt"></i></button><ul class="dropdown-menu"><li><a class="dropdown-item" href="#">Hoàn thành</a></li></ul></div></div></td></tr><tr><td>DH-0706C</td><td>Canifa</td><td><div class="progress" role="progressbar" style="height: 20px;"><div class="progress-bar bg-success" style="width: 100%">100%</div></div></td><td><span class="badge bg-success">Hoàn thành</span></td><td class="text-end">120.0M</td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#order-modal"><i class="fas fa-edit"></i></button></div></td></tr><tr><td>DH-0705D</td><td>Owen</td><td><div class="progress" role="progressbar" style="height: 20px;"><div class="progress-bar bg-danger" style="width: 0%">0%</div></div></td><td><span class="badge bg-danger">Đã hủy</span></td><td class="text-end">30.0M</td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#order-modal"><i class="fas fa-edit"></i></button></div></td></tr></tbody></table></div></div>
                <div class="card-footer d-flex justify-content-between align-items-center"><small class="text-muted">Hiển thị 1 - 4 trên tổng số 25</small><nav><ul class="pagination pagination-sm mb-0"><li class="page-item disabled"><a class="page-link" href="#">Trước</a></li><li class="page-item active"><a class="page-link" href="#">1</a></li><li class="page-item"><a class="page-link" href="#">2</a></li><li class="page-item"><a class="page-link" href="#">3</a></li><li class="page-item"><a class="page-link" href="#">Sau</a></li></ul></nav></div>
            </div>`,
        products: `<div class="d-flex justify-content-between align-items-center mb-4"><h3>Sản phẩm</h3><div class="btn-group"><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#product-modal"><i class="fas fa-plus me-2"></i>Thêm SP</button><button class="btn btn-outline-success"><i class="fas fa-file-excel me-2"></i>Xuất Excel</button></div></div>
            <div class="card shadow-sm">
                <div class="card-header">Danh sách Sản phẩm</div>
                <div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Mã SP</th><th>Tên sản phẩm</th><th>Khách hàng</th><th>Trạng thái</th><th class="text-center">Hành động</th></tr></thead><tbody><tr><td>QJ-AP-01</td><td>Quần Jean Wash Nam</td><td>An Phước</td><td><span class="badge bg-success">Đang áp dụng</span></td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#product-modal"><i class="fas fa-edit"></i></button><button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button></div></td></tr><tr><td>SM-AP-02</td><td>Áo Sơ Mi Nữ</td><td>An Phước</td><td><span class="badge bg-success">Đang áp dụng</span></td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#product-modal"><i class="fas fa-edit"></i></button><button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button></div></td></tr><tr><td>AK-BX-03</td><td>Áo Khoác Dù</td><td>Blue Exchange</td><td><span class="badge bg-success">Đang áp dụng</span></td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#product-modal"><i class="fas fa-edit"></i></button><button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button></div></td></tr><tr><td>VJ-CN-04</td><td>Váy Jean Nữ</td><td>Canifa</td><td><span class="badge bg-danger">Ngưng áp dụng</span></td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#product-modal"><i class="fas fa-edit"></i></button><button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button></div></td></tr></tbody></table></div></div>
                <div class="card-footer d-flex justify-content-between align-items-center"><small class="text-muted">Hiển thị 1 - 4 trên tổng số 4</small><nav><ul class="pagination pagination-sm mb-0"><li class="page-item disabled"><a class="page-link" href="#">Trước</a></li><li class="page-item active"><a class="page-link" href="#">1</a></li><li class="page-item disabled"><a class="page-link" href="#">Sau</a></li></ul></nav></div>
            </div>`,
        production: `<div class="d-flex justify-content-between align-items-center mb-4"><h3>Sản xuất</h3><button class="btn btn-outline-success"><i class="fas fa-file-excel me-2"></i>Xuất Tổng hợp</button></div><div class="card shadow-sm"><div class="card-body"><ul class="nav nav-tabs nav-tabs-responsive mb-3"><li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab-plan">Kế hoạch SX</a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-log">Nhật ký SX</a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-incidents">Báo cáo Sự cố</a></li></ul><div class="tab-content pt-2"><div class="tab-pane active" id="tab-plan"><div class="kanban-container"><div class="kanban-column"><h5><i class="fas fa-box-open text-secondary me-2"></i>Mới nhận</h5><div class="card my-2 kanban-card"><div class="card-body p-3"><h6 class="fw-bold mb-1">LÔ-0708-AP01</h6><small>ĐH: DH-0708A | SP: Quần Jean</small><div class="progress mt-2" role="progressbar" style="height: 10px;"><div class="progress-bar bg-primary" style="width: 10%;"></div></div><div class="d-flex justify-content-between mt-2 pt-2 border-top"><small class="text-muted"><i class="far fa-calendar-alt me-1"></i> 20/07</small><small><strong>SL: 500</strong></small></div></div><div class="card-footer text-center"><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#scan-modal"><i class="fas fa-edit me-1"></i>Cập nhật</button></div></div></div><div class="kanban-column"><h5><i class="fas fa-tint text-primary me-2"></i>Giặt/Nhuộm</h6><div class="card my-2 kanban-card"><div class="card-body p-3"><h6 class="fw-bold mb-1">LÔ-0707B-01</h6><small>ĐH: DH-0707B | SP: Áo Khoác</small><div class="progress mt-2" role="progressbar" style="height: 10px;"><div class="progress-bar bg-warning" style="width: 50%;"></div></div><div class="d-flex justify-content-between mt-2 pt-2 border-top"><small class="text-muted"><i class="far fa-calendar-alt me-1"></i> 18/07</small><small><strong>SL: 1000</strong></small></div></div><div class="card-footer text-center"><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#scan-modal"><i class="fas fa-edit me-1"></i>Cập nhật</button></div></div></div><div class="kanban-column"><h5><i class="fas fa-check-circle text-success me-2"></i>Hoàn thành</h6><div class="card my-2 kanban-card"><div class="card-body p-3"><h6 class="fw-bold mb-1">LÔ-0706C</h6><small>ĐH: DH-0706C | SP: Váy Jean</small><div class="progress mt-2" role="progressbar" style="height: 10px;"><div class="progress-bar bg-success" style="width: 100%;"></div></div><div class="d-flex justify-content-between mt-2 pt-2 border-top"><small class="text-muted"><i class="far fa-calendar-alt me-1"></i> 15/07</small><small><strong>SL: 3000</strong></small></div></div><div class="card-footer text-center"><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#scan-modal"><i class="fas fa-edit me-1"></i>Cập nhật</button></div></div></div></div></div><div class="tab-pane" id="tab-log"><div class="d-flex justify-content-between align-items-center mb-3"><h5 class="mb-0">Lịch sử ghi nhận</h5><button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#scan-modal"><i class="fas fa-edit me-2"></i>Ghi Nhật ký</button></div><div class="table-responsive"><table class="table table-sm table-bordered table-striped"><thead><th>Ngày giờ</th><th>Nhân viên</th><th>Mã Lô</th><th>Công đoạn</th><th class="text-end">SL</th><th class="text-end">Hư</th></tr></thead><tbody><tr><td>09/07 10:30</td><td>Nguyễn Văn A</td><td>LÔ-0707B-01</td><td>Giặt thô</td><td class="text-end">500</td><td class="text-end">5</td></tr></tbody></table></div></div><div class="tab-pane" id="tab-incidents"><div class="d-flex justify-content-end mb-3"><button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#incident-modal"><i class="fas fa-exclamation-triangle me-2"></i>Báo cáo Sự cố</button></div><div class="table-responsive"><table class="table table-hover align-middle"><thead><tr><th>Ngày</th><th>Bộ phận</th><th>Sản phẩm/Máy</th><th>Lỗi</th><th>Trạng thái</th><th class="text-center">Hành động</th></tr></thead><tbody><tr><td>10/07/2025</td><td>Nhuộm</td><td>Máy Nhuộm 02</td><td>Rò rỉ hóa chất</td><td><span class="badge bg-danger">Chưa xử lý</span></td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#incident-modal"><i class="fas fa-edit"></i></button><button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button></div></td></tr></tbody></table></div></div></div></div></div>`,
        delivery: `<div class="d-flex justify-content-between align-items-center mb-4"><h3>Giao hàng</h3><div class="btn-group"><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#delivery-modal"><i class="fas fa-plus me-2"></i>Thêm Phiếu</button><button class="btn btn-outline-success"><i class="fas fa-file-excel me-2"></i>Xuất Excel</button></div></div>
            <div class="card shadow-sm">
                <div class="card-header">Danh sách phiếu giao hàng</div>
                <div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Mã Phiếu</th><th>Ngày Giao</th><th>Khách hàng</th><th>Nội dung</th><th class="text-center">Trạng thái</th><th class="text-center">Hành động</th></tr></thead><tbody><tr><td>GH-0709A</td><td>09/07</td><td>Canifa</td><td>LÔ-0706C (Váy Jean, 3000)</td><td class="text-center"><span class="badge bg-success">Đã giao</span></td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-info" title="In phiếu"><i class="fas fa-print"></i></button></div></td></tr><tr><td>-</td><td>-</td><td>Blue Exchange</td><td>LÔ-0707B (Áo Khoác, 1000)</td><td class="text-center"><span class="badge bg-warning text-dark">Chờ giao</span></td><td class="text-center"><div class="btn-group btn-group-sm"><button type="button" class="btn btn-outline-secondary">Tạo phiếu</button></div></td></tr></tbody></table></div></div>
                <div class="card-footer d-flex justify-content-between align-items-center"><small class="text-muted">Hiển thị 1 - 2 trên tổng số 2</small><nav><ul class="pagination pagination-sm mb-0"><li class="page-item disabled"><a class="page-link" href="#">Trước</a></li><li class="page-item active"><a class="page-link" href="#">1</a></li><li class="page-item disabled"><a class="page-link" href="#">Sau</a></li></ul></nav></div>
            </div>`,
        // ... (other templates with pagination added)
        finance: `<div class="d-flex justify-content-between align-items-center mb-4"><h3>Thu - Chi</h3><button class="btn btn-outline-success"><i class="fas fa-file-excel me-2"></i>Xuất Excel</button></div>
            <div class="card shadow-sm">
                <div class="card-body">
                    <ul class="nav nav-tabs nav-tabs-responsive mb-3"><li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab-thu">Phiếu Thu</a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-chi">Phiếu Chi</a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-tonghop">Tổng hợp</a></li></ul>
                    <div class="tab-content pt-2">
                        <div class="tab-pane active" id="tab-thu">
                            <div class="d-flex justify-content-end mb-3"><button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#finance-modal" data-type="receipt"><i class="fas fa-plus me-2"></i>Thêm Thu</button></div>
                            <div class="table-responsive"><table class="table table-sm table-hover align-middle"><thead><tr><th>Ngày</th><th>Nội dung</th><th>Trạng thái</th><th class="text-end">Số tiền</th><th class="text-center">Hành động</th></tr></thead><tbody><tr><td>08/07</td><td>An Phước thanh toán ĐH-0708A</td><td><span class="badge bg-success">Đã duyệt</span></td><td class="text-end">22.5M</td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#finance-modal" data-type="receipt"><i class="fas fa-edit"></i></button></div></td></tr></tbody></table></div>
                            <div class="d-flex justify-content-between align-items-center mt-3 border-top pt-2"><small class="text-muted">Hiển thị 1 - 1 trên tổng số 1</small><nav><ul class="pagination pagination-sm mb-0"><li class="page-item disabled"><a class="page-link" href="#">Trước</a></li><li class="page-item active"><a class="page-link" href="#">1</a></li><li class="page-item disabled"><a class="page-link" href="#">Sau</a></li></ul></nav></div>
                        </div>
                        <div class="tab-pane" id="tab-chi">
                            <div class="d-flex justify-content-end mb-3"><button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#finance-modal" data-type="payment"><i class="fas fa-plus me-2"></i>Thêm Chi</button></div>
                            <div class="table-responsive"><table class="table table-sm table-hover align-middle"><thead><tr><th>Ngày</th><th>Nội dung</th><th>Trạng thái</th><th class="text-end">Số tiền</th><th class="text-center">Hành động</th></tr></thead><tbody><tr><td>07/07</td><td>Chi tiền điện tháng 6</td><td><span class="badge bg-success">Đã duyệt</span></td><td class="text-end">(15.0M)</td><td class="text-center"><div class="btn-group btn-group-sm"><button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#finance-modal" data-type="payment"><i class="fas fa-edit"></i></button></div></td></tr></tbody></table></div>
                             <div class="d-flex justify-content-between align-items-center mt-3 border-top pt-2"><small class="text-muted">Hiển thị 1 - 1 trên tổng số 1</small><nav><ul class="pagination pagination-sm mb-0"><li class="page-item disabled"><a class="page-link" href="#">Trước</a></li><li class="page-item active"><a class="page-link" href="#">1</a></li><li class="page-item disabled"><a class="page-link" href="#">Sau</a></li></ul></nav></div>
                        </div>
                        <div class="tab-pane" id="tab-tonghop"><h5 class="mb-3">Tổng hợp trong kỳ</h5><div class="row mt-3"><div class="col-6 col-lg-4 mb-3"><div class="card text-center bg-success-subtle text-success-emphasis h-100"><div class="card-header bg-transparent border-0 fw-bold text-uppercase">TỔNG THU</div><div class="card-body fs-4 fw-bolder">142.5M</div></div></div><div class="col-6 col-lg-4 mb-3"><div class="card text-center bg-danger-subtle text-danger-emphasis h-100"><div class="card-header bg-transparent border-0 fw-bold text-uppercase">TỔNG CHI</div><div class="card-body fs-4 fw-bolder">(25.2M)</div></div></div><div class="col-12 col-lg-4 mb-3"><div class="card text-center bg-primary-subtle text-primary-emphasis h-100"><div class="card-header bg-transparent border-0 fw-bold text-uppercase">LỢI NHUẬN</div><div class="card-body fs-4 fw-bolder">117.3M</div></div></div></div></div>
                    </div>
                </div>
            </div>`,
        users: `<div class="d-flex justify-content-between align-items-center mb-4"><h3>Người dùng</h3><div class="btn-group"><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#user-modal"><i class="fas fa-user-plus me-2"></i>Thêm User</button><button class="btn btn-outline-success"><i class="fas fa-file-excel me-2"></i>Xuất Excel</button></div></div>
            <div class="card shadow-sm">
                <div class="card-header">Danh sách người dùng</div>
                <div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Tên hiển thị</th><th>Email</th><th>Vai trò</th><th>Trạng thái</th><th class="text-center">Hành động</th></tr></thead><tbody><tr><td>Binh Mai</td><td>binh.mai@email.com</td><td><span class="badge bg-primary">Admin</span></td><td><span class="badge bg-success">Hoạt động</span></td><td class="text-center"><button class="btn btn-sm btn-outline-warning"><i class="fas fa-edit"></i></button></td></tr></tbody></table></div></div>
                <div class="card-footer d-flex justify-content-between align-items-center"><small class="text-muted">Hiển thị 1 - 1 trên tổng số 1</small><nav><ul class="pagination pagination-sm mb-0"><li class="page-item disabled"><a class="page-link" href="#">Trước</a></li><li class="page-item active"><a class="page-link" href="#">1</a></li><li class="page-item disabled"><a class="page-link" href="#">Sau</a></li></ul></nav></div>
            </div>`,
        'my-profile': `<h3 class="mb-4">Thông tin cá nhân</h3><div class="card shadow-sm"><div class="card-body"><div class="row g-4"><div class="col-md-4 text-center"><img src="https://i.pravatar.cc/150?u=binhmai" class="rounded-circle img-thumbnail mb-3" alt="Avatar"><input type="file" id="avatarUpload" class="d-none"><label for="avatarUpload" class="btn btn-outline-primary"><i class="fas fa-camera me-2"></i>Đổi ảnh</label></div><div class="col-md-8"><form><h5>Thông tin cơ bản</h5><div class="row g-3 mb-4"><div class="col-lg-6"><label class="form-label">Họ và tên</label><input type="text" class="form-control" value="Binh Mai"></div><div class="col-lg-6"><label class="form-label">Email</label><input type="email" class="form-control" value="binh.mai@email.com"></div></div><h5>Đổi mật khẩu</h5><div class="row g-3"><div class="col-lg-4"><label class="form-label">Mật khẩu cũ</label><input type="password" class="form-control"></div><div class="col-lg-4"><label class="form-label">Mật khẩu mới</label><input type="password" class="form-control"></div><div class="col-lg-4"><label class="form-label">Xác nhận MK mới</label><input type="password" class="form-control"></div></div><div class="mt-4"><button type="submit" class="btn btn-success"><i class="fas fa-save me-2"></i>Lưu</button></div></form></div></div></div></div>`,
        // The rest of the templates can be added here with pagination as needed.
    };

    function initializeTooltips() {
        bsTooltipList.forEach(t => t.dispose());
        bsTooltipList = [...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(el => new bootstrap.Tooltip(el));
    }

    function renderView(viewId) {
        // Destroy any existing charts to prevent memory leaks
        Object.values(chartInstances).forEach(chart => chart.destroy());
        chartInstances = {};

        // Special handling for submenu clicks in homepage
        if (viewId === 'hrSubmenu') viewId = 'payroll';
        if (viewId === 'settingsSubmenu') viewId = 'master-data';
        if (viewId === 'reports') viewId = 'dashboard'; // Default report view could be the old dashboard

        globalSearchInput.placeholder = searchPlaceholders[viewId] || 'Tìm kiếm...';
        mainContentArea.innerHTML = viewTemplates[viewId] || `<h3 class="p-5">Chức năng <strong>${viewId}</strong> đang được phát triển...</h3>`;
        mainContentArea.classList.add('active');
        setTimeout(() => mainContentArea.classList.remove('active'), 500);

        initializeTooltips();
    }
    
    function setActiveLink(targetLink) {
        document.querySelectorAll('#sidebar .components li').forEach(li => li.classList.remove('active'));
        if (targetLink) {
            const parentLi = targetLink.closest('li');
            if (parentLi) {
                parentLi.classList.add('active');
                
                // If the link is inside a collapsed submenu, open it and activate the parent
                const submenu = targetLink.closest('.collapse');
                if (submenu) {
                    const trigger = document.querySelector(`a[href="#${submenu.id}"]`);
                    if (trigger) {
                        trigger.closest('li').classList.add('active');
                        if (!submenu.classList.contains('show')) {
                            new bootstrap.Collapse(submenu).show();
                        }
                    }
                }
            }
        }
    }

    function toggleMobileSidebar() {
        sidebar.classList.toggle('show');
        sidebarOverlay.classList.toggle('active');
    }

    desktopSidebarToggleBtn.addEventListener('click', () => { document.body.classList.toggle('sidebar-collapsed'); });
    mobileSidebarToggleBtn.addEventListener('click', toggleMobileSidebar);
    sidebarOverlay.addEventListener('click', toggleMobileSidebar);

    if (customDateRangeTrigger) {
        customDateRangeTrigger.addEventListener('click', (e) => {
            e.preventDefault();
            timeFilterDropdown.classList.add('d-none');
            customDateRangeFilter.classList.remove('d-none');
        });
    }
    if (cancelCustomDateRangeBtn) {
        cancelCustomDateRangeBtn.addEventListener('click', () => {
            customDateRangeFilter.classList.add('d-none');
            timeFilterDropdown.classList.remove('d-none');
        });
    }

    document.body.addEventListener('click', (e) => {
        const link = e.target.closest('.nav-link, .nav-link-profile, .homepage-menu-item');
        if (link && link.dataset.view) {
            e.preventDefault();
            const viewId = link.dataset.view;
            renderView(viewId);
            
            // Activate the corresponding sidebar link
            let sidebarLink = document.querySelector(`#sidebar .nav-link[data-view="${viewId}"]`);
            if (!sidebarLink) { // Handle submenu clicks from homepage
                 if (['payroll', 'attendance', 'leave', 'kpis'].includes(viewId)) {
                     sidebarLink = document.querySelector(`#sidebar .nav-link[data-view="payroll"]`);
                 } else if (['master-data', 'users', 'roles'].includes(viewId)) {
                     sidebarLink = document.querySelector(`#sidebar .nav-link[data-view="master-data"]`);
                 } else if (['finance', 'accounts'].includes(viewId)) {
                     sidebarLink = document.querySelector(`#sidebar .nav-link[data-view="finance"]`);
                 }
            }
            setActiveLink(sidebarLink);
            
            if (window.innerWidth < 992 && sidebar.classList.contains('show')) {
                toggleMobileSidebar();
            }
        }
    });

    // Initial load
    renderView('dashboard');
    setActiveLink(document.querySelector(`#sidebar .nav-link[data-view="dashboard"]`));
});
</script>
</body>
</html>
